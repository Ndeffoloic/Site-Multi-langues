{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card">
                <div class="card-header">
                    {% trans 'Chatbot' %}
                </div>
                <ul class="list-group list-group-flush" id="chat-list">
                    <!-- Les messages du chat seront ajoutés ici -->
                </ul>
                <div class="card-body">
                    <div class="input-group">
                        <input type="text" id="chat-input" class="form-control" placeholder="{% trans 'Tapez votre message...' %}">
                        <button class="btn btn-primary" type="button" id="send-btn">{% trans 'Envoyer' %}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="{% static 'js/chat.js' %}"></script>
<script>
    const sendButton = document.getElementById('send-btn');
    const chatInput = document.getElementById('chat-input');
    const chatList = document.getElementById('chat-list');

    sendButton.addEventListener('click', async () => {
        const message = chatInput.value;

        const response = await fetch('{% url "chatbot" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ message: message })
        });

        const data = await response.json();
        const responseElement = document.createElement('li');
        responseElement.textContent = data.response || 'Erreur lors de la génération de la réponse.';
        chatList.appendChild(responseElement);

        chatInput.value = '';
    });
</script>
{% endblock %}
{% endblock %}